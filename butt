#! /bin/sh

prefix="test"

print_pass() {
  :
}

print_fail() {
  sed 's/^/  /'
}

runtest() {
  filename=$1
  output="$("$filename" 2>&1)"
  success=$?
  if [ $success -eq 0 ]; then
    print_pass
  else
    echo "$filename"
    echo "$output" | print_fail
  fi
  return $success
}

tests() {
  find . -maxdepth 1 -name "$prefix*" | sort
}

runtests() {
  fail=0

  while read filename; do
    if [ -d "$filename" ]; then
      continue
    fi
    runtest "$filename" || fail=1
  done

  return $fail
}

tests | runtests
